<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Paper Tiger: The talloc reference function.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Paper Tiger
   </div>
   <div id="projectbrief">An open-source Terraria server written in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">The talloc reference function.<div class="ingroups"><a class="el" href="group__talloc.html">The talloc API</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This module contains the definitions around talloc references.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__talloc__array"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__talloc__array.html">The talloc array functions</a></td></tr>
<tr class="memdesc:group__talloc__array"><td class="mdescLeft">&#160;</td><td class="mdescRight">Talloc contains some handy helpers for handling Arrays conveniently. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gaa31ec88dc1174f500625c92f3c15f054"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaa31ec88dc1174f500625c92f3c15f054"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>talloc_reference</b>(ctx,  ptr)&#160;&#160;&#160;(_TALLOC_TYPEOF(ptr))_talloc_reference_loc((ctx),(ptr), __location__)</td></tr>
<tr class="separator:gaa31ec88dc1174f500625c92f3c15f054"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1d70927673b42a6d2e42823307280502"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__talloc__ref.html#ga1d70927673b42a6d2e42823307280502">talloc_increase_ref_count</a> (const void *ptr)</td></tr>
<tr class="memdesc:ga1d70927673b42a6d2e42823307280502"><td class="mdescLeft">&#160;</td><td class="mdescRight">Increase the reference count of a talloc chunk.  <a href="#ga1d70927673b42a6d2e42823307280502">More...</a><br /></td></tr>
<tr class="separator:ga1d70927673b42a6d2e42823307280502"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac8bc504b29c4a0b3252e69f14a241035"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__talloc__ref.html#gac8bc504b29c4a0b3252e69f14a241035">talloc_reference_count</a> (const void *ptr)</td></tr>
<tr class="memdesc:gac8bc504b29c4a0b3252e69f14a241035"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the number of references to a talloc chunk.  <a href="#gac8bc504b29c4a0b3252e69f14a241035">More...</a><br /></td></tr>
<tr class="separator:gac8bc504b29c4a0b3252e69f14a241035"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafe478eebc954a90bf11ffee3ea73b885"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gafe478eebc954a90bf11ffee3ea73b885"></a>
void *&#160;</td><td class="memItemRight" valign="bottom"><b>_talloc_reference_loc</b> (const void *context, const void *ptr, const char *location)</td></tr>
<tr class="separator:gafe478eebc954a90bf11ffee3ea73b885"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8054dd3561f33dd4a0d6942839868bb5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__talloc__ref.html#ga8054dd3561f33dd4a0d6942839868bb5">talloc_unlink</a> (const void *context, void *ptr)</td></tr>
<tr class="memdesc:ga8054dd3561f33dd4a0d6942839868bb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove a specific parent from a talloc chunk.  <a href="#ga8054dd3561f33dd4a0d6942839868bb5">More...</a><br /></td></tr>
<tr class="separator:ga8054dd3561f33dd4a0d6942839868bb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga68f90d9a904bc2125b9bb60146f004de"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__talloc__ref.html#ga68f90d9a904bc2125b9bb60146f004de">talloc_autofree_context</a> (void)</td></tr>
<tr class="memdesc:ga68f90d9a904bc2125b9bb60146f004de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Provide a talloc context that is freed at program exit.  <a href="#ga68f90d9a904bc2125b9bb60146f004de">More...</a><br /></td></tr>
<tr class="separator:ga68f90d9a904bc2125b9bb60146f004de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0cbdb71be91a8a1e8f9dc6486beb690f"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__talloc__ref.html#ga0cbdb71be91a8a1e8f9dc6486beb690f">talloc_get_size</a> (const void *ctx)</td></tr>
<tr class="memdesc:ga0cbdb71be91a8a1e8f9dc6486beb690f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the size of a talloc chunk.  <a href="#ga0cbdb71be91a8a1e8f9dc6486beb690f">More...</a><br /></td></tr>
<tr class="separator:ga0cbdb71be91a8a1e8f9dc6486beb690f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaba977c578a3d871e6f1ec53b67495ce2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__talloc__ref.html#gaba977c578a3d871e6f1ec53b67495ce2">talloc_show_parents</a> (const void *context, FILE *file)</td></tr>
<tr class="memdesc:gaba977c578a3d871e6f1ec53b67495ce2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Show the parentage of a context.  <a href="#gaba977c578a3d871e6f1ec53b67495ce2">More...</a><br /></td></tr>
<tr class="separator:gaba977c578a3d871e6f1ec53b67495ce2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7d00105b11e2a92a2e6972b3d0df0ba5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__talloc__ref.html#ga7d00105b11e2a92a2e6972b3d0df0ba5">talloc_is_parent</a> (const void *context, const void *ptr)</td></tr>
<tr class="memdesc:ga7d00105b11e2a92a2e6972b3d0df0ba5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a context is parent of a talloc chunk.  <a href="#ga7d00105b11e2a92a2e6972b3d0df0ba5">More...</a><br /></td></tr>
<tr class="separator:ga7d00105b11e2a92a2e6972b3d0df0ba5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad08d78c3987437a5753efc55379f0566"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__talloc__ref.html#gad08d78c3987437a5753efc55379f0566">talloc_reparent</a> (const void *old_parent, const void *new_parent, const void *ptr)</td></tr>
<tr class="memdesc:gad08d78c3987437a5753efc55379f0566"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change the parent context of a talloc pointer.  <a href="#gad08d78c3987437a5753efc55379f0566">More...</a><br /></td></tr>
<tr class="separator:gad08d78c3987437a5753efc55379f0566"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module contains the definitions around talloc references. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga68f90d9a904bc2125b9bb60146f004de"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* talloc_autofree_context </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Provide a talloc context that is freed at program exit. </p>
<p>This is a handy utility function that returns a talloc context which will be automatically freed on program exit. This can be used to reduce the noise in memory leak reports.</p>
<p>Never use this in code that might be used in objects loaded with dlopen and unloaded with dlclose. <a class="el" href="group__talloc__ref.html#ga68f90d9a904bc2125b9bb60146f004de" title="Provide a talloc context that is freed at program exit. ">talloc_autofree_context()</a> internally uses atexit(3). Some platforms like modern Linux handles this fine, but for example FreeBSD does not deal well with dlopen() and atexit() used simultaneously: dlclose() does not clean up the list of atexit-handlers, so when the program exits the code that was registered from within <a class="el" href="group__talloc__ref.html#ga68f90d9a904bc2125b9bb60146f004de" title="Provide a talloc context that is freed at program exit. ">talloc_autofree_context()</a> is gone, the program crashes at exit.</p>
<dl class="section return"><dt>Returns</dt><dd>A talloc context, NULL on error. </dd></dl>

</div>
</div>
<a class="anchor" id="ga0cbdb71be91a8a1e8f9dc6486beb690f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t talloc_get_size </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the size of a talloc chunk. </p>
<p>This function lets you know the amount of memory allocated so far by this context. It does NOT account for subcontext memory. This can be used to calculate the size of an array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>The talloc chunk.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The size of the talloc chunk. </dd></dl>

</div>
</div>
<a class="anchor" id="ga1d70927673b42a6d2e42823307280502"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int talloc_increase_ref_count </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Increase the reference count of a talloc chunk. </p>
<p>The talloc_increase_ref_count(ptr) function is exactly equivalent to:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;talloc_reference(NULL, ptr);</div>
</div><!-- fragment --><p>You can use either syntax, depending on which you think is clearer in your code.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ptr</td><td>The pointer to increase the reference count.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on error. </dd></dl>

</div>
</div>
<a class="anchor" id="ga7d00105b11e2a92a2e6972b3d0df0ba5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int talloc_is_parent </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if a context is parent of a talloc chunk. </p>
<p>This checks if context is referenced in the talloc hierarchy above ptr.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The assumed talloc context.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ptr</td><td>The talloc chunk to check.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return 1 if this is the case, 0 if not. </dd></dl>

</div>
</div>
<a class="anchor" id="gac8bc504b29c4a0b3252e69f14a241035"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t talloc_reference_count </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the number of references to a talloc chunk. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ptr</td><td>The pointer to retrieve the reference count from.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of references. </dd></dl>

</div>
</div>
<a class="anchor" id="gad08d78c3987437a5753efc55379f0566"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* talloc_reparent </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>old_parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>new_parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Change the parent context of a talloc pointer. </p>
<p>The function changes the parent context of a talloc pointer. It is typically used when the context that the pointer is currently a child of is going to be freed and you wish to keep the memory for a longer time.</p>
<p>The difference between <a class="el" href="group__talloc__ref.html#gad08d78c3987437a5753efc55379f0566" title="Change the parent context of a talloc pointer. ">talloc_reparent()</a> and talloc_steal() is that <a class="el" href="group__talloc__ref.html#gad08d78c3987437a5753efc55379f0566" title="Change the parent context of a talloc pointer. ">talloc_reparent()</a> can specify which parent you wish to change. This is useful when a pointer has multiple parents via references.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">old_parent</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">new_parent</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ptr</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return the pointer you passed. It does not have any failure modes. </dd></dl>

</div>
</div>
<a class="anchor" id="gaba977c578a3d871e6f1ec53b67495ce2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void talloc_show_parents </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Show the parentage of a context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The talloc context to look at.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">file</td><td>The output to use, a file, stdout or stderr. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga8054dd3561f33dd4a0d6942839868bb5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int talloc_unlink </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove a specific parent from a talloc chunk. </p>
<p>The function removes a specific parent from ptr. The context passed must either be a context used in talloc_reference() with this pointer, or must be a direct parent of ptr.</p>
<p>You can just use talloc_free() instead of <a class="el" href="group__talloc__ref.html#ga8054dd3561f33dd4a0d6942839868bb5" title="Remove a specific parent from a talloc chunk. ">talloc_unlink()</a> if there is at maximum one parent. This behaviour has been changed since the release of version 2.0. Further informations in the description of "talloc_free".</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The talloc parent to remove.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ptr</td><td>The talloc ptr you want to remove the parent from.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on error.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>If the parent has already been removed using talloc_free() then this function will fail and will return -1. Likewise, if ptr is NULL, then the function will make no modifications and return -1.</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;unsigned int *a, *b, *c;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;a = talloc(NULL, unsigned int);</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;b = talloc(NULL, unsigned int);</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;c = talloc(a, unsigned int);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;// b also serves as a parent of c.</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;talloc_reference(b, c);</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;talloc_unlink(b, c);</div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
