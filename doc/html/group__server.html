<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Paper Tiger: Server subsystem</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Paper Tiger
   </div>
   <div id="projectbrief">An open-source Terraria server written in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Server subsystem<div class="ingroups"><a class="el" href="group__paper-tiger.html">The Paper Tiger API</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The server subsystem lives inside the <code>game</code> context, and is responsible for managing and talking to connected clients via the <em>Terraria</em> protocol.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structserver.html">server</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes a server context.  <a href="structserver.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac98cdc3daa5c89785e0dae45dc8d6c56"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__server.html#gac98cdc3daa5c89785e0dae45dc8d6c56">server_new</a> (<a class="el" href="group__talloc.html#ga8a521b1347c0e37b84eb942db8fa9beb">TALLOC_CTX</a> *context, const char *listen_address, const uint16_t port, struct <a class="el" href="structgame.html">game</a> *<a class="el" href="structgame.html">game</a>, struct <a class="el" href="structserver.html">server</a> **out_server)</td></tr>
<tr class="memdesc:gac98cdc3daa5c89785e0dae45dc8d6c56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates a new server context, with the specified listen address and port.  <a href="#gac98cdc3daa5c89785e0dae45dc8d6c56">More...</a><br /></td></tr>
<tr class="separator:gac98cdc3daa5c89785e0dae45dc8d6c56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf6735c294993687a5e385b1e2e2f778f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__server.html#gaf6735c294993687a5e385b1e2e2f778f">server_start</a> (struct <a class="el" href="structserver.html">server</a> *<a class="el" href="structserver.html">server</a>)</td></tr>
<tr class="memdesc:gaf6735c294993687a5e385b1e2e2f778f"><td class="mdescLeft">&#160;</td><td class="mdescRight">starts the server  <a href="#gaf6735c294993687a5e385b1e2e2f778f">More...</a><br /></td></tr>
<tr class="separator:gaf6735c294993687a5e385b1e2e2f778f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga139b4c0888c43a7e35793bcb25f3c522"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__server.html#ga139b4c0888c43a7e35793bcb25f3c522">server_send_packet</a> (const struct <a class="el" href="structplayer.html">player</a> *<a class="el" href="structplayer.html">player</a>, const struct <a class="el" href="structpacket.html">packet</a> *<a class="el" href="structpacket.html">packet</a>)</td></tr>
<tr class="memdesc:ga139b4c0888c43a7e35793bcb25f3c522"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a packet to the specified player.  <a href="#ga139b4c0888c43a7e35793bcb25f3c522">More...</a><br /></td></tr>
<tr class="separator:ga139b4c0888c43a7e35793bcb25f3c522"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The server subsystem lives inside the <code>game</code> context, and is responsible for managing and talking to connected clients via the <em>Terraria</em> protocol. </p>
<p>The <code>server</code> system has routines for decoding and encoding <em>Terraria</em> messages, as well as callbacks for managing the TCP connections to all its clients. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gac98cdc3daa5c89785e0dae45dc8d6c56"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int server_new </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__talloc.html#ga8a521b1347c0e37b84eb942db8fa9beb">TALLOC_CTX</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>listen_address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structgame.html">game</a> *&#160;</td>
          <td class="paramname"><em>game</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structserver.html">server</a> **&#160;</td>
          <td class="paramname"><em>out_server</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a new server context, with the specified listen address and port. </p>
<p>Allocates a new server object underneath the specified talloc context, with the specified <em>listen_address</em> and <em>port</em>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The talloc context in which to allocate memory for this server context underneath.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">listen_address</td><td>The IPv4 interface listen address to listen for TCP connections on.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">port</td><td>Specifies the TCP port on which to listen on</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">game</td><td>A pointer to the game context in which to allocate a server object under</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_server</td><td>A pointer to the address in which the allocated server structure may be stored.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> if the server context was allocated successfully, <code>&lt; 0</code> if an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="ga139b4c0888c43a7e35793bcb25f3c522"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int server_send_packet </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structplayer.html">player</a> *&#160;</td>
          <td class="paramname"><em>player</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structpacket.html">packet</a> *&#160;</td>
          <td class="paramname"><em>packet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a packet to the specified player. </p>
<p>Sends a packet pointed to by <em>packet</em>, to the client pointed to by <em>player</em>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">player</td><td>A pointer to an allocated and joined player object whom to send the packet</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">packet</td><td>A pointer to an allocated packet to send to the player.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> if the packet was queued for sending successfully, <code>&lt; 0</code> otherwise.</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>The successful return from this function does <b>not</b> indicate that the packet was sent successfully and arrived at its destination. It merely guarantees that the packet was queued for sending to the client at the return of this function.</dd></dl>
<p>The packet buffers rely on function callbacks in the packet handler table to be able to send the data to the client. The packet's data stream is copied from the packet into the send queue, thus the caller of this function still owns the memory pointed to by <em>packet</em> and is responsible for freeing it. </p>

</div>
</div>
<a class="anchor" id="gaf6735c294993687a5e385b1e2e2f778f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int server_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structserver.html">server</a> *&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>starts the server </p>
<p>Starts the server pointed to by <em>server</em>, by opening a server socket on the specified TCP address and port, and listening for clients on the game context's event loop.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">server</td><td>A pointer to an allocated server object in which to start listening for clients.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> if the server start operation was successful, <code>&lt; 0</code> otherwise.</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>This function will return <code>-1</code> if it cannot listen for clients, for reasons such as socket bind failures, port open failures, AVC denies, etc. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
