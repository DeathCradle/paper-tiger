<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Paper Tiger: Game system</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Paper Tiger
   </div>
   <div id="projectbrief">An open-source Terraria server written in C</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Game system<div class="ingroups"><a class="el" href="group__paper-tiger.html">The Paper Tiger API</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The game system is the root of all server mechanics and serves as the game environment.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgame.html">game</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes a game context.  <a href="structgame.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga41778fe633eab7e582b77f526d1bc2bc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__game.html#ga41778fe633eab7e582b77f526d1bc2bc">game_find_next_slot</a> (struct <a class="el" href="structgame.html">game</a> *context)</td></tr>
<tr class="memdesc:ga41778fe633eab7e582b77f526d1bc2bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">finds the next free slot from the game's player slot bitmap  <a href="#ga41778fe633eab7e582b77f526d1bc2bc">More...</a><br /></td></tr>
<tr class="separator:ga41778fe633eab7e582b77f526d1bc2bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga88814baf2c6a6420c803184a99025d58"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__game.html#ga88814baf2c6a6420c803184a99025d58">game_start_event_loop</a> (struct <a class="el" href="structgame.html">game</a> *context)</td></tr>
<tr class="memdesc:ga88814baf2c6a6420c803184a99025d58"><td class="mdescLeft">&#160;</td><td class="mdescRight">starts the game's event loop  <a href="#ga88814baf2c6a6420c803184a99025d58">More...</a><br /></td></tr>
<tr class="separator:ga88814baf2c6a6420c803184a99025d58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6646ca0fed74050e1e89e716fd9af25f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__game.html#ga6646ca0fed74050e1e89e716fd9af25f">game_new</a> (<a class="el" href="group__talloc.html#ga8a521b1347c0e37b84eb942db8fa9beb">TALLOC_CTX</a> *context, struct <a class="el" href="structgame.html">game</a> **out_context)</td></tr>
<tr class="memdesc:ga6646ca0fed74050e1e89e716fd9af25f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates a new game context.  <a href="#ga6646ca0fed74050e1e89e716fd9af25f">More...</a><br /></td></tr>
<tr class="separator:ga6646ca0fed74050e1e89e716fd9af25f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga08208c25319f60c6f5cccdee8b895cb4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__game.html#ga08208c25319f60c6f5cccdee8b895cb4">game_update_loop_init</a> (struct <a class="el" href="structgame.html">game</a> *<a class="el" href="structgame.html">game</a>)</td></tr>
<tr class="memdesc:ga08208c25319f60c6f5cccdee8b895cb4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the game update timer which fires at every tickrate interval.  <a href="#ga08208c25319f60c6f5cccdee8b895cb4">More...</a><br /></td></tr>
<tr class="separator:ga08208c25319f60c6f5cccdee8b895cb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The game system is the root of all server mechanics and serves as the game environment. </p>
<p>In the <code>talloc</code> heirarchy, all memory is allocated underneath the game context, and its free should close and release all memory and subsystems to do with the game context. In other words, freeing the game context should completely stop and release the entire game.</p>
<p>As paper tiger is object-oriented, the game environment is not set in globals or statics. Any data related to the the game or the game's environment must be allocated underneath the game context in the talloc heirarchy, and stored as one of the members in the game structure, or any substructure underneath the game context.</p>
<p>The game context contains references to the <b>world</b> systems, the <b>player</b> systems, and the <b>server</b> systems so that none of the systems exist in a fixed address space and may be fully cleaned up on a call to <code>talloc_free(game)</code>. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga41778fe633eab7e582b77f526d1bc2bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int game_find_next_slot </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgame.html">game</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>finds the next free slot from the game's player slot bitmap </p>
<p>Finds the next free slot in the game context's player slot bitmap and returns it to the caller. Exchanges the slot to <code>1 (used)</code> before returning it, so subsequent calls to this function will not return the same ID.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>A pointer to the game context in which to find the next free player slot for</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The ID of the next free player slot (<code>&gt;= 0</code>) if a player slot exists, or -1 if there are no more slots available or there was an error. </dd></dl>

</div>
</div>
<a class="anchor" id="ga6646ca0fed74050e1e89e716fd9af25f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int game_new </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__talloc.html#ga8a521b1347c0e37b84eb942db8fa9beb">TALLOC_CTX</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structgame.html">game</a> **&#160;</td>
          <td class="paramname"><em>out_context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates a new game context. </p>
<p>Allocates a new game context under a parent talloc context pointed to by <em>context</em>. </p>

</div>
</div>
<a class="anchor" id="ga88814baf2c6a6420c803184a99025d58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int game_start_event_loop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgame.html">game</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>starts the game's event loop </p>
<p>Starts the game's event loop. This function will block until the loop is closed with calls to <em>uv_close</em>, or the loop somehow otherwise terminates.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>A pointer to the game context in which to start the event loop.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This function currently always returns <code>0</code>. </dd></dl>

</div>
</div>
<a class="anchor" id="ga08208c25319f60c6f5cccdee8b895cb4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int game_update_loop_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgame.html">game</a> *&#160;</td>
          <td class="paramname"><em>game</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the game update timer which fires at every tickrate interval. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">game</td><td>A pointer to the game context in which to start the timer</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> if the update loop was initialized successfully, <code>&lt; 0</code> otherwise.</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>The game update timer is a libuv timer, which is smart enough to adjust itself according to the time it takes for the game update procedure to finish. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
